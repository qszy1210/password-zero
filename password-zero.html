<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>ç¦»çº¿å¯†ç åº“</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      line-height: 1.6;
      background: #f8f9fa;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      display: flex;
      height: 100vh;
      gap: 0;
    }
    /* å·¦ä¾§è¯´æ˜åŒºåŸŸ */
    .info-panel {
      width: 35%;
      min-width: 320px;
      max-width: 450px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }
    .info-panel h2 {
      color: white;
      font-size: 24px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(255,255,255,0.3);
    }
    .info-panel p {
      margin-bottom: 10px;
      opacity: 0.95;
      font-size: 14px;
    }
    .info-box {
      background: rgba(255,255,255,0.15);
      border-left: 4px solid rgba(255,255,255,0.5);
      padding: 10px;
      margin: 12px 0;
      border-radius: 4px;
      backdrop-filter: blur(10px);
    }
    .info-box strong {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
    }
    .info-box ol {
      margin: 6px 0 0 0;
      padding-left: 20px;
      font-size: 13px;
    }
    .info-box li {
      margin-bottom: 4px;
      opacity: 0.9;
    }
    .info-box code {
      background: rgba(0,0,0,0.2);
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 11px;
    }
    /* å³ä¾§æ“ä½œåŒºåŸŸ */
    .operations-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      overflow: hidden;
    }
    /* Tabå¯¼èˆªæ  */
    .tab-navigation {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e0e0e0;
      padding: 0;
    }
    .tab-button {
      flex: 1;
      padding: 18px 20px;
      background: transparent;
      border: none;
      border-radius: 0;
      font-size: 16px;
      font-weight: 600;
      color: #7f8c8d;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
      margin: 0;
      position: relative;
    }
    .tab-button:hover {
      background: rgba(102, 126, 234, 0.05);
      color: #667eea;
      transform: none;
      box-shadow: none;
    }
    .tab-button.active {
      color: #667eea;
      background: white;
      border-bottom: 3px solid #667eea;
    }
    .tab-button .tab-icon {
      font-size: 18px;
      margin-right: 8px;
    }
    .operations-wrapper {
      flex: 1;
      overflow-y: auto;
      padding: 20px 30px;
    }
    /* Tabå†…å®¹åŒºåŸŸ */
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* æ“ä½œåŒºåŸŸæ ·å¼ */
    section {
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
      padding: 15px;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    section:last-child {
      margin-bottom: 0;
    }
    h3 {
      color: #34495e;
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 18px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e0e0e0;
    }
    h4 {
      color: #555;
      margin-top: 10px;
      margin-bottom: 5px;
      font-size: 13px;
      font-weight: 600;
    }
    .label-group {
      margin-bottom: 10px;
    }
    label {
      display: block;
      font-weight: 600;
      color: #34495e;
      margin-bottom: 4px;
      font-size: 13px;
    }
    textarea,
    input[type="password"] {
      width: 100%;
      padding: 8px 10px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 13px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    textarea:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    textarea {
      resize: vertical;
      min-height: 65px;
    }
    small {
      display: block;
      margin-top: 3px;
      color: #7f8c8d;
      font-size: 11px;
    }
    button {
      margin-top: 8px;
      margin-right: 8px;
      padding: 8px 16px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s;
    }
    button:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    button.secondary {
      background: #95a5a6;
    }
    button.secondary:hover {
      background: #7f8c8d;
      box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
    }
    button.file-btn {
      background: #16a085;
    }
    button.file-btn:hover {
      background: #138d75;
      box-shadow: 0 4px 12px rgba(22, 160, 133, 0.3);
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #f8f9fa;
      padding: 10px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      max-height: 100px;
      overflow: auto;
      font-size: 11px;
      font-family: 'Courier New', monospace;
      margin: 6px 0;
    }
    .success-msg {
      color: #27ae60;
      font-weight: bold;
      margin-left: 8px;
      font-size: 12px;
    }
    /* å‘½ä»¤è¡Œè¯´æ˜åŒºåŸŸ */
    .cli-info {
      background: #2d3748;
      border-left: 4px solid #4299e1;
      padding: 12px;
      margin: 15px 0 0 0;
      border-radius: 6px;
      color: #e2e8f0;
    }
    .cli-info h5 {
      color: #4299e1;
      margin: 0 0 8px 0;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      user-select: none;
    }
    .cli-info h5:hover {
      color: #63b3ed;
    }
    .cli-info-toggle {
      font-size: 12px;
      margin-left: auto;
    }
    .cli-info-content {
      display: none;
    }
    .cli-info-content.show {
      display: block;
    }
    .cli-info code {
      background: #1a202c;
      color: #68d391;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 11px;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    }
    .cli-info pre {
      background: #1a202c;
      color: #e2e8f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 6px 0;
      font-size: 11px;
      line-height: 1.4;
      border: 1px solid #4a5568;
    }
    .cli-info p {
      margin: 6px 0;
      font-size: 12px;
      line-height: 1.5;
    }
    .cli-info ol {
      margin: 6px 0;
      padding-left: 18px;
      font-size: 12px;
    }
    .cli-info li {
      margin: 4px 0;
    }
    /* æœç´¢æ¨¡æ€æ¡†æ ·å¼ */
    .search-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
    }
    .search-modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalFadeIn 0.3s ease-out;
    }
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    .search-modal-header {
      padding: 20px 24px;
      border-bottom: 2px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px 12px 0 0;
    }
    .search-modal-header h3 {
      margin: 0;
      color: white;
      border: none;
      padding: 0;
      font-size: 20px;
    }
    .search-modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      margin: 0;
      padding: 0;
    }
    .search-modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: none;
      box-shadow: none;
    }
    .search-modal-body {
      padding: 20px 24px;
      overflow-y: auto;
      flex: 1;
    }
    .search-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      align-items: center;
    }
    .search-input-wrapper {
      flex: 1;
      min-width: 200px;
    }
    .search-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s;
    }
    .search-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .search-key-select {
      padding: 10px 12px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 150px;
    }
    .search-key-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .search-mode-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: all 0.3s;
      font-size: 13px;
      white-space: nowrap;
    }
    .search-mode-toggle:hover {
      background: #e9ecef;
      border-color: #667eea;
    }
    .search-mode-toggle input[type="checkbox"] {
      cursor: pointer;
      width: 16px;
      height: 16px;
    }
    .search-mode-label {
      color: #34495e;
      font-weight: 500;
    }
    .search-stats {
      padding: 8px 12px;
      background: #f0f4ff;
      border-left: 4px solid #667eea;
      border-radius: 4px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #34495e;
    }
    .search-results {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .search-result-item {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 10px 12px;
      transition: all 0.3s;
    }
    .search-result-item:hover {
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-color: #667eea;
    }
    .search-result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .search-result-title {
      font-weight: 600;
      color: #667eea;
      font-size: 15px;
      flex: 1;
    }
    .search-result-actions {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .search-action-btn {
      padding: 4px 8px;
      font-size: 11px;
      border: 1px solid #ddd;
      background: white;
      color: #34495e;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
      margin: 0;
    }
    .search-action-btn:hover {
      transform: none;
      box-shadow: none;
    }
    .search-action-btn.copy-btn {
      border-color: #16a085;
      color: #16a085;
    }
    .search-action-btn.copy-btn:hover {
      background: #16a085;
      color: white;
    }
    .search-action-btn.delete-btn {
      border-color: #e74c3c;
      color: #e74c3c;
    }
    .search-action-btn.delete-btn:hover {
      background: #e74c3c;
      color: white;
    }
    .search-result-item.deleted {
      opacity: 0.5;
      background: #ffebee;
      border-color: #e74c3c;
    }
    .search-result-item.deleted .search-result-title {
      text-decoration: line-through;
      color: #e74c3c;
    }
    .search-result-field {
      margin: 4px 0;
      font-size: 13px;
      display: flex;
      gap: 6px;
    }
    .search-result-label {
      font-weight: 600;
      color: #7f8c8d;
      min-width: 70px;
      flex-shrink: 0;
    }
    .search-result-value {
      color: #34495e;
      word-break: break-word;
      flex: 1;
    }
    .search-result-password {
      color: #95a5a6;
      font-family: monospace;
      cursor: pointer;
      user-select: none;
    }
    .search-result-password:hover {
      color: #34495e;
    }
    .search-empty {
      text-align: center;
      padding: 40px 20px;
      color: #95a5a6;
    }
    .search-empty-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    .highlight {
      background: #fff3cd;
      color: #856404;
      padding: 2px 0px;
      border-radius: 3px;
      font-weight: 600;
    }
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1024px) {
      .container {
        flex-direction: column;
      }
      .info-panel {
        width: 100%;
        max-width: 100%;
        height: 30vh;
        min-height: 200px;
      }
      .operations-panel {
        height: 70vh;
      }
      .search-modal-content {
        width: 95%;
        max-height: 95vh;
      }
      .search-controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§è¯´æ˜é¢æ¿ -->
    <div class="info-panel">
      <h2>ğŸ” ç¦»çº¿å¯†ç åº“</h2>
      <p>
        è¿™ä¸ªè‡ªåŒ…å«çš„HTMLæ–‡ä»¶å…è®¸æ‚¨ä½¿ç”¨Web Crypto APIåŠ å¯†å’Œå­˜å‚¨æ‚¨çš„å¯†ç åˆ—è¡¨ã€‚
        å®ƒå®Œå…¨ç¦»çº¿è¿è¡Œï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨JavaScriptåº“ï¼Œæ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°ã€‚
      </p>

      <div class="info-box">
        <strong>ğŸ“– ä½¿ç”¨æ–¹æ³•</strong>
        <ol>
          <li><strong>ğŸ”‘ æ¨èå·¥ä½œæµï¼ˆè§£å¯†Tabï¼‰ï¼š</strong>å¯¼å…¥åŠ å¯†æ–‡ä»¶ â†’ è§£å¯† â†’ ç¼–è¾‘ â†’ é‡æ–°åŠ å¯†å¯¼å‡ºï¼ˆå®Œæ•´å®‰å…¨é“¾è·¯ï¼‰</li>
          <li><strong>ğŸ” æ–°å»ºåŠ å¯†ï¼ˆåŠ å¯†Tabï¼‰ï¼š</strong>è¾“å…¥æ˜æ–‡å†…å®¹ â†’ è®¾ç½®å¯†ç  â†’ åŠ å¯† â†’ å¯¼å‡ºæ–‡ä»¶</li>
          <li><em>é«˜çº§ï¼š</em>å°†åŠ å¯†æ•°æ®æ°¸ä¹…ä¿å­˜åˆ°æ­¤æ–‡ä»¶ä¸­ï¼ˆç¼–è¾‘HTMLæºä»£ç ï¼Œæ›¿æ¢ <code>encryptedData</code> å˜é‡ï¼‰</li>
        </ol>
      </div>

      <div class="info-box">
        <strong>ğŸ”’ å®‰å…¨ç‰¹æ€§</strong>
        <ol>
          <li><strong>AES-256-GCM åŠ å¯†ï¼š</strong>é‡‡ç”¨å†›äº‹çº§åˆ«åŠ å¯†æ ‡å‡†</li>
          <li><strong>PBKDF2 å¯†é’¥æ´¾ç”Ÿï¼š</strong>100,000æ¬¡è¿­ä»£é˜²æš´åŠ›ç ´è§£</li>
          <li><strong>å®Œå…¨ç¦»çº¿ï¼š</strong>æ— éœ€ç½‘ç»œè¿æ¥ï¼Œæ•°æ®ä¸å¤–ä¼ </li>
          <li><strong>è‡ªåŠ¨æ¸…ç†ï¼š</strong>æ“ä½œå®Œæˆåè‡ªåŠ¨æ¸…é™¤å¯†ç å’Œæ•æ„Ÿæ•°æ®</li>
          <li><strong>æ— ç—•æ¨¡å¼ï¼š</strong>ç¦ç”¨æµè§ˆå™¨è‡ªåŠ¨å¡«å……å’Œå†å²è®°å½•</li>
        </ol>
      </div>

      <div class="info-box">
        <strong>ğŸ’¡ ä½¿ç”¨å»ºè®®</strong>
        <ol>
          <li>ä½¿ç”¨åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç¬¦å·çš„å¼ºä¸»å¯†ç </li>
          <li>å°†æ­¤æ–‡ä»¶å¤‡ä»½åˆ°å¤šä¸ªå®‰å…¨ä½ç½®</li>
          <li>å®šæœŸæ›´æ”¹ä¸»å¯†ç å¹¶é‡æ–°åŠ å¯†æ•°æ®</li>
          <li>ä¸è¦å¿˜è®°ä¸»å¯†ç ï¼Œå®ƒæ— æ³•æ¢å¤</li>
        </ol>
      </div>
    </div>

    <!-- å³ä¾§æ“ä½œé¢æ¿ -->
    <div class="operations-panel">
      <!-- Tabå¯¼èˆªæ  -->
      <div class="tab-navigation">
        <button class="tab-button" onclick="switchTab('encrypt')">
          <span class="tab-icon">ğŸ”</span>åŠ å¯†æ•°æ®
        </button>
        <button class="tab-button active" onclick="switchTab('decrypt')">
          <span class="tab-icon">ğŸ”‘</span>è§£å¯†æ•°æ®
        </button>
      </div>

      <div class="operations-wrapper">
        <!-- åŠ å¯†Tabå†…å®¹ -->
        <div id="encryptTab" class="tab-content">
          <section>
            <h3>ğŸ” åŠ å¯†æ•°æ®</h3>
            <div class="label-group">
              <label for="plaintext">è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬ï¼š</label>
              <textarea id="plaintext" rows="3" placeholder="ä¾‹å¦‚ï¼š&#10;ç½‘ç«™ï¼šexample.com&#10;ç”¨æˆ·åï¼šuser@email.com&#10;å¯†ç ï¼šMySecretPassword123"></textarea>
              <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
              <input type="file" id="importPlainFile" accept=".json,.txt,.xml,.md" style="display:none;" onchange="handleImportPlainFile(event)" />
            </div>
            <div class="label-group">
              <label for="encPassword">è®¾ç½®ä¸»å¯†ç ï¼š</label>
              <input type="password" id="encPassword" placeholder="è¯·è¾“å…¥ä¸€ä¸ªå¼ºä¸»å¯†ç "
                     autocomplete="off"
                     data-form-type="other"
                     spellcheck="false"
                     onkeypress="handlePasswordKeyPress(event, 'encrypt')" />
              <small style="color: #7f8c8d;">ğŸ’¡ æŒ‰å›è½¦é”®ç›´æ¥åŠ å¯†</small>
            </div>
            <button onclick="encrypt()">ğŸ” åŠ å¯†</button>
            <button class="file-btn" onclick="document.getElementById('importPlainFile').click()">ğŸ“‚ å¯¼å…¥æ–‡ä»¶</button>
            <button class="secondary" onclick="clearEncrypt()">ğŸ—‘ï¸ æ¸…ç©º</button>
            <h4>åŠ å¯†è¾“å‡ºï¼š</h4>
            <pre id="encryptedOutput">(åŠ å¯†åçš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ)</pre>
            <button id="copyBtn" onclick="copyToClipboard()" style="display:none;">ğŸ“‹ ä¸€é”®å¤åˆ¶</button>
            <button id="exportEncBtn" class="file-btn" onclick="exportEncryptedFile()" style="display:none;">ğŸ’¾ å¯¼å‡ºæ–‡ä»¶</button>
            <span id="copySuccess" class="success-msg" style="display:none;">âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</span>

            <!-- å‘½ä»¤è¡Œè¯´æ˜ -->
            <div class="cli-info">
              <h5 onclick="toggleInfo('encryptCli')">
                ğŸ’» å‘½ä»¤è¡Œæ–¹å¼åŠ å¯†ï¼ˆå¯é€‰ï¼‰
                <span class="cli-info-toggle" id="encryptCliToggle">â–¼ å±•å¼€</span>
              </h5>
              <div class="cli-info-content" id="encryptCli">
                <p>å¦‚æœä¸ä½¿ç”¨ç½‘é¡µï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>openssl</code> å‘½ä»¤è¡Œå·¥å…·å®ç°åŠ å¯†ï¼š</p>
                <ol>
                  <li>å°†è¦åŠ å¯†çš„æ–‡æœ¬ä¿å­˜åˆ°æ–‡ä»¶ï¼š<code>echo "ä½ çš„å¯†ç å†…å®¹" > plaintext.txt</code></li>
                  <li>ä½¿ç”¨AES-256-CBCåŠ å¯†ï¼š</li>
                </ol>
                <pre>openssl enc -aes-256-cbc -salt -pbkdf2 -iter 100000 \
  -in plaintext.txt -out encrypted.bin -k "ä½ çš„ä¸»å¯†ç "</pre>
                <ol start="3">
                  <li>è½¬æ¢ä¸ºBase64æ–¹ä¾¿ä¼ è¾“ï¼š</li>
                </ol>
                <pre>base64 encrypted.bin > encrypted.txt</pre>
                <p><strong>æ³¨æ„ï¼š</strong>æ­¤å‘½ä»¤è¡Œæ–¹å¼ä¸ç½‘é¡µç‰ˆä½¿ç”¨ç›¸åŒçš„åŠ å¯†æ ‡å‡†ï¼ˆAES-256 + PBKDF2ï¼‰ï¼Œä½†æ•°æ®æ ¼å¼ç•¥æœ‰ä¸åŒã€‚å»ºè®®ç»Ÿä¸€ä½¿ç”¨ä¸€ç§æ–¹å¼ã€‚</p>
              </div>
            </div>
          </section>
        </div>

        <!-- è§£å¯†Tabå†…å®¹ -->
        <div id="decryptTab" class="tab-content active">
          <section>
            <h3>ğŸ”‘ è§£å¯†æ•°æ®</h3>

            <!-- å®‰å…¨æç¤º -->
            <div class="cli-info" style="margin-bottom: 12px; background: #1e3a5f; border-left-color: #4299e1;">
              <h5 onclick="toggleInfo('securityInfo')">
                ğŸ›¡ï¸ å®‰å…¨é“¾è·¯è¯´æ˜
                <span class="cli-info-toggle" id="securityInfoToggle">â–¼ å±•å¼€</span>
              </h5>
              <div class="cli-info-content" id="securityInfo">
                <p>æœ¬é¡µé¢æ”¯æŒå®Œæ•´çš„å®‰å…¨å·¥ä½œæµç¨‹ï¼š</p>
                <ol>
                  <li><strong>å¯¼å…¥åŠ å¯†æ–‡ä»¶</strong> â†’ é€‰æ‹©æœ¬åœ°åŠ å¯†çš„JSONæ–‡ä»¶</li>
                  <li><strong>è¾“å…¥å¯†ç è§£å¯†</strong> â†’ ä½¿ç”¨ä¸»å¯†ç æŸ¥çœ‹å†…å®¹</li>
                  <li><strong>ç›´æ¥ç¼–è¾‘ä¿®æ”¹</strong> â†’ åœ¨æ–‡æœ¬æ¡†ä¸­ç¼–è¾‘å¯†ç ä¿¡æ¯</li>
                  <li><strong>é‡æ–°åŠ å¯†å¯¼å‡º</strong> â†’ è‡ªåŠ¨ä½¿ç”¨ç›¸åŒå¯†ç åŠ å¯†å¹¶ä¿å­˜</li>
                </ol>
                <p><strong>ğŸ”’ å®‰å…¨ä¿è¯ï¼š</strong>æ‰€æœ‰æ“ä½œåœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œå¯†ç è‡ªåŠ¨æ¸…ç†ï¼Œä¸ç•™ç—•è¿¹ã€‚</p>
              </div>
            </div>

            <div class="label-group">
              <label for="encryptedInput">ç²˜è´´åŠ å¯†æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰ï¼š</label>
              <textarea id="encryptedInput" rows="2" placeholder='ç²˜è´´åŠ å¯†è¾“å‡ºï¼Œæˆ–ç‚¹å‡»"å¯¼å…¥æ–‡ä»¶"æŒ‰é’®é€‰æ‹©åŠ å¯†æ–‡ä»¶'></textarea>
              <small>ğŸ’¡ å¦‚æœæ­¤æ–‡ä»¶å·²å†…ç½®åŠ å¯†æ•°æ®ï¼Œå¯ä»¥ç•™ç©ºæ­¤è¾“å…¥æ¡†</small>
              <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
              <input type="file" id="importEncFile" accept=".json,.txt,.xml,.md" style="display:none;" onchange="handleImportEncFile(event)" />
            </div>

            <div class="label-group">
              <label for="decPassword">è¾“å…¥ä¸»å¯†ç ï¼š</label>
              <input type="password" id="decPassword" placeholder="è¯·è¾“å…¥ä¸»å¯†ç "
                     autocomplete="off"
                     data-form-type="other"
                     spellcheck="false"
                     onkeypress="handlePasswordKeyPress(event, 'decrypt')" />
              <small style="color: #e67e22;">âš ï¸ å¯†ç åœ¨è§£å¯†/é‡æ–°åŠ å¯†åä¼šè‡ªåŠ¨æ¸…é™¤ï¼Œç¡®ä¿å®‰å…¨ã€‚æŒ‰å›è½¦é”®ç›´æ¥è§£å¯†</small>
            </div>

            <button onclick="decrypt()">ğŸ”‘ è§£å¯†</button>
            <button class="file-btn" onclick="document.getElementById('importEncFile').click()">ğŸ“‚ å¯¼å…¥æ–‡ä»¶</button>
            <button class="secondary" onclick="clearDecrypt()">ğŸ—‘ï¸ æ¸…ç©º</button>

            <h4>è§£å¯†åçš„æ•°æ®ï¼ˆå¯ç¼–è¾‘ï¼‰ï¼š</h4>
            <textarea id="decryptedOutput" rows="5"
                      placeholder="(è§£å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘)"
                      oninput="handleDecryptedContentChange()"
                      spellcheck="false"></textarea>
            <button id="exportDecBtn" class="file-btn" onclick="exportDecryptedFile()" style="display:none;">ğŸ’¾ å¯¼å‡ºæ˜æ–‡</button>
            <button id="searchBtn" class="file-btn" onclick="openSearchModal()" style="display:none; background: #f39c12;">ğŸ” ç»“æœæœç´¢</button>
            <button id="quickAddBtn" class="file-btn" onclick="openQuickAddModal()" style="display:none; background: #27ae60;">â• å¿«é€Ÿæ·»åŠ </button>
            <button id="reEncryptBtn" class="file-btn" onclick="reEncryptAndExport()" style="display:none;">ğŸ” åŠ å¯†å¹¶å¯¼å‡º</button>
            <span id="modifiedIndicator" style="display:none; color: #e67e22; font-weight: bold; margin-left: 10px;">âš ï¸ å†…å®¹å·²ä¿®æ”¹</span>

            <!-- å‘½ä»¤è¡Œè¯´æ˜ -->
            <div class="cli-info">
              <h5 onclick="toggleInfo('decryptCli')">
                ğŸ’» å‘½ä»¤è¡Œæ–¹å¼è§£å¯†ï¼ˆå¯é€‰ï¼‰
                <span class="cli-info-toggle" id="decryptCliToggle">â–¼ å±•å¼€</span>
              </h5>
              <div class="cli-info-content" id="decryptCli">
                <p>å¦‚æœä¸ä½¿ç”¨ç½‘é¡µï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>openssl</code> å‘½ä»¤è¡Œå·¥å…·å®ç°è§£å¯†ï¼š</p>
                <ol>
                  <li>å¦‚æœåŠ å¯†æ–‡ä»¶æ˜¯Base64æ ¼å¼ï¼Œå…ˆè§£ç ï¼š<code>base64 -d encrypted.txt > encrypted.bin</code></li>
                  <li>ä½¿ç”¨AES-256-CBCè§£å¯†ï¼š</li>
                </ol>
                <pre>openssl enc -aes-256-cbc -d -pbkdf2 -iter 100000 \
  -in encrypted.bin -out decrypted.txt -k "ä½ çš„ä¸»å¯†ç "</pre>
                <ol start="3">
                  <li>æŸ¥çœ‹è§£å¯†åçš„å†…å®¹ï¼š<code>cat decrypted.txt</code></li>
                </ol>
                <p><strong>æ³¨æ„ï¼š</strong>å‘½ä»¤è¡Œæ–¹å¼éœ€è¦ä¸åŠ å¯†æ—¶ä½¿ç”¨çš„æ–¹æ³•åŒ¹é…ã€‚å¦‚æœä½¿ç”¨ç½‘é¡µåŠ å¯†ï¼Œå»ºè®®ä¹Ÿä½¿ç”¨ç½‘é¡µè§£å¯†ä»¥ä¿è¯å…¼å®¹æ€§ã€‚</p>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- æœç´¢æ¨¡æ€æ¡† -->
  <div id="searchModal" class="search-modal" onclick="closeSearchModalOnBackdrop(event)">
    <div class="search-modal-content">
      <div class="search-modal-header">
        <h3>ğŸ” æœç´¢è§£å¯†æ•°æ®</h3>
        <button class="search-modal-close" onclick="closeSearchModal()">Ã—</button>
      </div>
      <div class="search-modal-body">
        <!-- æœç´¢æ§åˆ¶åŒºåŸŸ -->
        <div class="search-controls">
          <div class="search-input-wrapper">
            <input type="text"
                   id="searchInput"
                   class="search-input"
                   placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œå¦‚ï¼šaf å¯åŒ¹é… asdf78ï¼‰"
                   oninput="performSearch()"
                   autocomplete="off" />
          </div>
          <select id="searchKeySelect" class="search-key-select" onchange="performSearch()">
            <option value="default">é»˜è®¤æœç´¢å­—æ®µ</option>
            <option value="title">ä»…æœç´¢ title</option>
            <option value="username">ä»…æœç´¢ username</option>
            <option value="info">ä»…æœç´¢ info</option>
            <option value="uuid">ä»…æœç´¢ uuid</option>
            <option value="password">ä»…æœç´¢ password</option>
            <option value="created">ä»…æœç´¢ created</option>
            <option value="modified">ä»…æœç´¢ modified</option>
          </select>
          <label class="search-mode-toggle" title="å‹¾é€‰ååªåŒ¹é…è¿ç»­å­—ç¬¦ï¼Œå¦‚ af åªåŒ¹é… afï¼Œä¸åŒ¹é… asdf">
            <input type="checkbox" id="continuousMode" onchange="performSearch()" checked />
            <span class="search-mode-label">è¿ç»­åŒ¹é…</span>
          </label>
        </div>

        <!-- æœç´¢ç»Ÿè®¡ -->
        <div id="searchStats" class="search-stats" style="display:none;">
          æ‰¾åˆ° <strong id="searchCount">0</strong> æ¡ç»“æœ
        </div>

        <!-- æœç´¢ç»“æœåŒºåŸŸ -->
        <div id="searchResults" class="search-results"></div>
      </div>
    </div>
  </div>

  <!-- å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡† -->
  <div id="quickAddModal" class="search-modal" onclick="closeQuickAddModalOnBackdrop(event)">
    <div class="search-modal-content" style="max-width: 600px;">
      <div class="search-modal-header">
        <h3>â• å¿«é€Ÿæ·»åŠ å¯†ç é¡¹</h3>
        <button class="search-modal-close" onclick="closeQuickAddModal()">Ã—</button>
      </div>
      <div class="search-modal-body">
        <div style="margin-bottom: 15px;">
          <label for="quickAddTitle" style="display: block; font-weight: 600; margin-bottom: 6px; color: #34495e;">æ ‡é¢˜ (Title) *</label>
          <input type="text" id="quickAddTitle" placeholder="ä¾‹å¦‚ï¼šGitHub è´¦å·"
                 style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;" />
        </div>
        <div style="margin-bottom: 15px;">
          <label for="quickAddUsername" style="display: block; font-weight: 600; margin-bottom: 6px; color: #34495e;">ç”¨æˆ·å (Username)</label>
          <input type="text" id="quickAddUsername" placeholder="ä¾‹å¦‚ï¼šuser@example.com"
                 style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;" />
        </div>
        <div style="margin-bottom: 15px;">
          <label for="quickAddPassword" style="display: block; font-weight: 600; margin-bottom: 6px; color: #34495e;">å¯†ç  (Password) *</label>
          <input type="text" id="quickAddPassword" placeholder="è¾“å…¥å¯†ç "
                 autocomplete="new-password"
                 style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;" />
        </div>
        <div style="margin-bottom: 15px;">
          <label for="quickAddInfo" style="display: block; font-weight: 600; margin-bottom: 6px; color: #34495e;">å¤‡æ³¨ (Info)</label>
          <textarea id="quickAddInfo" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸ªäººå¼€å‘è´¦å·ï¼Œç”¨äºå¼€æºé¡¹ç›®"
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical;"></textarea>
        </div>
        <div style="padding: 12px; background: #f0f4ff; border-left: 4px solid #667eea; border-radius: 4px; margin-bottom: 15px; font-size: 13px; color: #34495e;">
          ğŸ’¡ UUID å’Œæ—¥æœŸå­—æ®µå°†è‡ªåŠ¨ç”Ÿæˆ
        </div>
        <div style="text-align: right;">
          <button onclick="closeQuickAddModal()" class="secondary" style="margin-right: 8px;">å–æ¶ˆ</button>
          <button onclick="submitQuickAdd()" style="background: #27ae60;">âœ“ æ·»åŠ </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ***** é‡è¦æç¤º *****
    // å°†'null'æ›¿æ¢ä¸ºåŠ å¯†è¾“å‡ºçš„JSONå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼š{"salt":"...","iv":"...","ciphertext":"..."}ï¼‰ã€‚
    // æ›¿æ¢åä¿å­˜æ­¤æ–‡ä»¶ã€‚å½“æ‚¨é‡æ–°æ‰“å¼€å®ƒå¹¶è¾“å…¥ä¸»å¯†ç æ—¶ï¼Œè§£å¯†åŠŸèƒ½å°†ç”Ÿæ•ˆã€‚
    var encryptedData = null;

    // å­˜å‚¨åŸå§‹è§£å¯†å†…å®¹ï¼Œç”¨äºæ£€æµ‹æ˜¯å¦è¢«ä¿®æ”¹
    var originalDecryptedContent = '';

    // --- ç¼–ç /è§£ç å·¥å…·å‡½æ•° ---
    function toUint8Array(str) {
      return new TextEncoder().encode(str);
    }
    function fromUint8Array(buf) {
      return new TextDecoder().decode(buf);
    }
    function arrayBufferToBase64(buffer) {
      var binary = '';
      var bytes = new Uint8Array(buffer);
      var len = bytes.byteLength;
      for (var i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return btoa(binary);
    }
    function base64ToArrayBuffer(base64) {
      var binary = atob(base64);
      var len = binary.length;
      var bytes = new Uint8Array(len);
      for (var i = 0; i < len; i++) {
        bytes[i] = binary.charCodeAt(i);
      }
      return bytes.buffer;
    }
    async function getKeyMaterial(password) {
      return await window.crypto.subtle.importKey(
        'raw',
        toUint8Array(password),
        'PBKDF2',
        false,
        ['deriveKey']
      );
    }
    async function deriveKey(password, salt) {
      var keyMaterial = await getKeyMaterial(password);
      return await window.crypto.subtle.deriveKey(
        {
          name: 'PBKDF2',
          salt: salt,
          iterations: 100000,
          hash: 'SHA-256'
        },
        keyMaterial,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt', 'decrypt']
      );
    }
    async function encryptData(plaintext, password) {
      var salt = window.crypto.getRandomValues(new Uint8Array(16));
      var iv = window.crypto.getRandomValues(new Uint8Array(12));
      var key = await deriveKey(password, salt);
      var encoded = toUint8Array(plaintext);
      var ciphertext = await window.crypto.subtle.encrypt({ name: 'AES-GCM', iv: iv }, key, encoded);
      return {
        salt: arrayBufferToBase64(salt),
        iv: arrayBufferToBase64(iv),
        ciphertext: arrayBufferToBase64(ciphertext)
      };
    }
    async function decryptData(data, password) {
      if (typeof data === 'string') {
        data = JSON.parse(data);
      }
      var salt = base64ToArrayBuffer(data.salt);
      var iv = base64ToArrayBuffer(data.iv);
      var ciphertext = base64ToArrayBuffer(data.ciphertext);
      var key = await deriveKey(password, new Uint8Array(salt));
      var decrypted = await window.crypto.subtle.decrypt(
        { name: 'AES-GCM', iv: new Uint8Array(iv) },
        key,
        ciphertext
      );
      return fromUint8Array(new Uint8Array(decrypted));
    }
    async function encrypt() {
      var plaintext = document.getElementById('plaintext').value;
      var password = document.getElementById('encPassword').value;
      if (!plaintext) {
        alert('è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬');
        return;
      }
      if (!password) {
        alert('è¯·è¾“å…¥ä¸»å¯†ç ');
        return;
      }
      var encData = await encryptData(plaintext, password);
      var jsonString = JSON.stringify(encData);
      document.getElementById('encryptedOutput').textContent = jsonString;
      // æ˜¾ç¤ºå¤åˆ¶å’Œå¯¼å‡ºæŒ‰é’®
      document.getElementById('copyBtn').style.display = 'inline-block';
      document.getElementById('exportEncBtn').style.display = 'inline-block';
      document.getElementById('copySuccess').style.display = 'none';
    }
    async function decrypt() {
      var password = document.getElementById('decPassword').value;
      if (!password) {
        alert('è¯·è¾“å…¥ä¸»å¯†ç ');
        return;
      }

      // ä¼˜å…ˆä»è¾“å…¥æ¡†è¯»å–åŠ å¯†æ•°æ®
      var encryptedInput = document.getElementById('encryptedInput').value.trim();
      var dataToDecrypt = null;

      if (encryptedInput) {
        // ä½¿ç”¨è¾“å…¥æ¡†ä¸­çš„åŠ å¯†æ•°æ®
        try {
          dataToDecrypt = JSON.parse(encryptedInput);
        } catch (e) {
          alert('åŠ å¯†æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿ç²˜è´´çš„æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼');
          return;
        }
      } else if (encryptedData) {
        // å¦‚æœè¾“å…¥æ¡†ä¸ºç©ºï¼Œä½¿ç”¨å†…ç½®çš„ encryptedData
        dataToDecrypt = encryptedData;
      } else {
        alert('æœªæ‰¾åˆ°åŠ å¯†æ•°æ®ã€‚è¯·åœ¨ä¸Šæ–¹è¾“å…¥æ¡†ä¸­ç²˜è´´åŠ å¯†æ•°æ®ï¼Œæˆ–åœ¨æ–‡ä»¶ä¸­è®¾ç½® encryptedData å˜é‡ã€‚');
        return;
      }

      try {
        var plaintext = await decryptData(dataToDecrypt, password);
        document.getElementById('decryptedOutput').value = plaintext;
        // å­˜å‚¨åŸå§‹å†…å®¹ç”¨äºæ£€æµ‹ä¿®æ”¹
        originalDecryptedContent = plaintext;
        // æ˜¾ç¤ºå¯¼å‡ºæŒ‰é’®å’Œæœç´¢æŒ‰é’®ï¼Œéšè—é‡æ–°åŠ å¯†æŒ‰é’®å’Œä¿®æ”¹æŒ‡ç¤ºå™¨
        document.getElementById('exportDecBtn').style.display = 'inline-block';
        document.getElementById('searchBtn').style.display = 'inline-block';
        document.getElementById('quickAddBtn').style.display = 'inline-block';
        document.getElementById('reEncryptBtn').style.display = 'none';
        document.getElementById('modifiedIndicator').style.display = 'none';

        // å®‰å…¨æç¤ºï¼šè§£å¯†æˆåŠŸåå¯†ç ä»ä¿ç•™ï¼Œç”¨äºåç»­çš„é‡æ–°åŠ å¯†
        console.log('âœ“ è§£å¯†æˆåŠŸ - å¯†ç å·²ä¿ç•™ç”¨äºé‡æ–°åŠ å¯†');

        // è§£å¯†æˆåŠŸåï¼Œè®©å¯†ç è¾“å…¥æ¡†å¤±ç„¦
        document.getElementById('decPassword').blur();
      } catch (err) {
        alert('è§£å¯†å¤±è´¥ï¼šå¯†ç é”™è¯¯æˆ–æ•°æ®å·²æŸå');
        console.error(err);
        // è§£å¯†å¤±è´¥æ—¶æ¸…é™¤å¯†ç 
        securelyCleanPassword('decPassword');
      }
    }

    // ä¸€é”®å¤åˆ¶åŠŸèƒ½
    function copyToClipboard() {
      var encryptedText = document.getElementById('encryptedOutput').textContent;
      if (!encryptedText || encryptedText === '(åŠ å¯†åçš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ)') {
        alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
        return;
      }
      navigator.clipboard.writeText(encryptedText).then(function() {
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        var successMsg = document.getElementById('copySuccess');
        successMsg.style.display = 'inline';
        // 3ç§’åè‡ªåŠ¨éšè—
        setTimeout(function() {
          successMsg.style.display = 'none';
        }, 3000);
      }).catch(function(err) {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + err);
      });
    }

    // æ¸…ç©ºåŠ å¯†åŒºåŸŸ
    function clearEncrypt() {
      document.getElementById('plaintext').value = '';
      document.getElementById('encPassword').value = '';
      document.getElementById('encryptedOutput').textContent = '(åŠ å¯†åçš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ)';
      document.getElementById('copyBtn').style.display = 'none';
      document.getElementById('exportEncBtn').style.display = 'none';
      document.getElementById('copySuccess').style.display = 'none';
    }

    // ===== å¿«é€Ÿæ·»åŠ åŠŸèƒ½ =====

    // ç”ŸæˆUUID
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0;
        var v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // è·å–å½“å‰æ—¥æœŸ (YYYY-MM-DDæ ¼å¼)
    function getCurrentDate() {
      var now = new Date();
      var year = now.getFullYear();
      var month = String(now.getMonth() + 1).padStart(2, '0');
      var day = String(now.getDate()).padStart(2, '0');
      return year + '-' + month + '-' + day;
    }

    // æ‰“å¼€å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†
    function openQuickAddModal() {
      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      document.getElementById('quickAddModal').classList.add('show');

      // æ¸…ç©ºè¡¨å•
      document.getElementById('quickAddTitle').value = '';
      document.getElementById('quickAddUsername').value = '';
      document.getElementById('quickAddPassword').value = '';
      document.getElementById('quickAddInfo').value = '';

      // èšç„¦åˆ°æ ‡é¢˜è¾“å…¥æ¡†
      setTimeout(function() {
        document.getElementById('quickAddTitle').focus();
      }, 100);
    }

    // å…³é—­å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†
    function closeQuickAddModal() {
      document.getElementById('quickAddModal').classList.remove('show');

      // æ¸…ç©ºè¡¨å•
      document.getElementById('quickAddTitle').value = '';
      document.getElementById('quickAddUsername').value = '';
      document.getElementById('quickAddPassword').value = '';
      document.getElementById('quickAddInfo').value = '';
    }

    // ç‚¹å‡»èƒŒæ™¯å…³é—­å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†
    function closeQuickAddModalOnBackdrop(event) {
      if (event.target.id === 'quickAddModal') {
        closeQuickAddModal();
      }
    }

    // æäº¤å¿«é€Ÿæ·»åŠ 
    function submitQuickAdd() {
      var title = document.getElementById('quickAddTitle').value.trim();
      var username = document.getElementById('quickAddUsername').value.trim();
      var password = document.getElementById('quickAddPassword').value.trim();
      var info = document.getElementById('quickAddInfo').value.trim();

      // éªŒè¯å¿…å¡«å­—æ®µ
      if (!title) {
        alert('è¯·è¾“å…¥æ ‡é¢˜ (Title)');
        document.getElementById('quickAddTitle').focus();
        return;
      }

      if (!password) {
        alert('è¯·è¾“å…¥å¯†ç  (Password)');
        document.getElementById('quickAddPassword').focus();
        return;
      }

      // è·å–å½“å‰è§£å¯†çš„æ•°æ®
      var decryptedText = document.getElementById('decryptedOutput').value;
      var dataArray = [];

      try {
        if (decryptedText) {
          dataArray = JSON.parse(decryptedText);

          // ç¡®ä¿æ˜¯æ•°ç»„
          if (!Array.isArray(dataArray)) {
            dataArray = [dataArray];
          }
        }
      } catch (e) {
        alert('å½“å‰è§£å¯†æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•æ·»åŠ æ–°é¡¹');
        console.error('JSONè§£æå¤±è´¥:', e);
        return;
      }

      // åˆ›å»ºæ–°çš„æ•°æ®é¡¹
      var newItem = {
        uuid: generateUUID(),
        title: title,
        username: username,
        password: password,
        info: info,
        created: getCurrentDate(),
        modified: getCurrentDate()
      };

      // æ·»åŠ åˆ°æ•°ç»„
      dataArray.push(newItem);

      // æ›´æ–°åˆ°è§£å¯†è¾“å‡ºæ¡†
      document.getElementById('decryptedOutput').value = JSON.stringify(dataArray, null, 2);

      // è§¦å‘å†…å®¹ä¿®æ”¹æ£€æµ‹
      handleDecryptedContentChange();

      // å…³é—­æ¨¡æ€æ¡†
      closeQuickAddModal();

      // æç¤ºæˆåŠŸ
      alert('âœ“ æ–°é¡¹å·²æ·»åŠ æˆåŠŸ\n\næ ‡é¢˜ï¼š' + title + '\n\nè¯·ä½¿ç”¨"åŠ å¯†å¹¶å¯¼å‡º"æŒ‰é’®ä¿å­˜æ›´æ”¹');
    }

    // æ¸…ç©ºè§£å¯†åŒºåŸŸ
    function clearDecrypt() {
      document.getElementById('encryptedInput').value = '';
      securelyCleanPassword('decPassword');
      document.getElementById('decryptedOutput').value = '';
      document.getElementById('exportDecBtn').style.display = 'none';
      document.getElementById('searchBtn').style.display = 'none';
      document.getElementById('quickAddBtn').style.display = 'none';
      document.getElementById('reEncryptBtn').style.display = 'none';
      document.getElementById('modifiedIndicator').style.display = 'none';
      originalDecryptedContent = '';
    }

    // ===== æ–‡ä»¶å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ =====

    // å¯¼å…¥æ˜æ–‡æ–‡ä»¶åˆ°åŠ å¯†åŒºåŸŸ
    function handleImportPlainFile(event) {
      var file = event.target.files[0];
      if (!file) return;

      var reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('plaintext').value = e.target.result;
      };
      reader.onerror = function() {
        alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
      };
      reader.readAsText(file, 'UTF-8');
    }

    // å¯¼å‡ºåŠ å¯†æ•°æ®åˆ°æ–‡ä»¶
    function exportEncryptedFile() {
      var encryptedText = document.getElementById('encryptedOutput').textContent;
      if (!encryptedText || encryptedText === '(åŠ å¯†åçš„æ•°æ®å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ)') {
        alert('æ²¡æœ‰å¯å¯¼å‡ºçš„åŠ å¯†æ•°æ®');
        return;
      }

      // åˆ›å»ºBlobå¯¹è±¡
      var blob = new Blob([encryptedText], { type: 'application/json' });

      // åˆ›å»ºä¸‹è½½é“¾æ¥
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'encrypted_' + new Date().getTime() + '.json';

      // è§¦å‘ä¸‹è½½
      document.body.appendChild(a);
      a.click();

      // æ¸…ç†
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      alert('âœ“ åŠ å¯†æ–‡ä»¶å·²å¯¼å‡º');

      // æ£€æŸ¥æ˜æ–‡å’Œå¯†ç æ˜¯å¦å·²ç»ä¸ºç©º
      var plaintext = document.getElementById('plaintext').value;
      var password = document.getElementById('encPassword').value;

      // åªæœ‰åœ¨æ˜æ–‡æˆ–å¯†ç ä¸ä¸ºç©ºæ—¶ï¼Œæ‰è¯¢é—®æ˜¯å¦æ¸…ç©º
      if (plaintext || password) {
        var shouldClear = confirm('ğŸ”’ æ˜¯å¦æ¸…ç©ºåŸæ˜æ–‡ä»¥åŠå¯†ç ï¼Ÿ\n\né€‰æ‹©"ç¡®å®š"å°†æ¸…ç©ºè¾“å…¥çš„æ˜æ–‡å†…å®¹å’Œå¯†ç ï¼Œç¡®ä¿å®‰å…¨ã€‚\né€‰æ‹©"å–æ¶ˆ"å°†ä¿ç•™å½“å‰å†…å®¹ã€‚');

        if (shouldClear) {
          // æ¸…ç©ºæ˜æ–‡å’Œå¯†ç 
          document.getElementById('plaintext').value = '';
          securelyCleanPassword('encPassword');
          console.log('ğŸ—‘ï¸ å·²æ¸…ç©ºåŸæ˜æ–‡å’Œå¯†ç ');
        }
      }
    }

    // å¯¼å…¥åŠ å¯†æ–‡ä»¶åˆ°è§£å¯†åŒºåŸŸ
    function handleImportEncFile(event) {
      var file = event.target.files[0];
      if (!file) return;

      var reader = new FileReader();
      reader.onload = function(e) {
        var content = e.target.result;
        // éªŒè¯æ˜¯å¦æ˜¯æœ‰æ•ˆçš„JSON
        try {
          JSON.parse(content);
          document.getElementById('encryptedInput').value = content;

          // å¯¼å…¥æˆåŠŸåï¼Œè‡ªåŠ¨èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†
          setTimeout(function() {
            document.getElementById('decPassword').focus();
          }, 100);
        } catch (err) {
          alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿æ˜¯æœ‰æ•ˆçš„åŠ å¯†æ–‡ä»¶ï¼ˆJSONæ ¼å¼ï¼‰');
        }
      };
      reader.onerror = function() {
        alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
      };
      reader.readAsText(file, 'UTF-8');
    }

    // å¯¼å‡ºè§£å¯†åçš„æ–‡æœ¬åˆ°æ–‡ä»¶
    function exportDecryptedFile() {
      var decryptedText = document.getElementById('decryptedOutput').value;
      if (!decryptedText || decryptedText === '(è§£å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘)') {
        alert('æ²¡æœ‰å¯å¯¼å‡ºçš„è§£å¯†æ•°æ®');
        return;
      }

      // åˆ›å»ºBlobå¯¹è±¡
      var blob = new Blob([decryptedText], { type: 'text/plain;charset=utf-8' });

      // åˆ›å»ºä¸‹è½½é“¾æ¥
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'decrypted_' + new Date().getTime() + '.txt';

      // è§¦å‘ä¸‹è½½
      document.body.appendChild(a);
      a.click();

      // æ¸…ç†
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      alert('âœ“ è§£å¯†æ–‡ä»¶å·²å¯¼å‡º');
    }

    // æ£€æµ‹è§£å¯†å†…å®¹æ˜¯å¦è¢«ä¿®æ”¹
    function handleDecryptedContentChange() {
      var currentContent = document.getElementById('decryptedOutput').value;

      // å¦‚æœå†…å®¹è¢«ä¿®æ”¹äº†ï¼Œæ˜¾ç¤º"åŠ å¯†å¹¶å¯¼å‡º"æŒ‰é’®å’Œä¿®æ”¹æŒ‡ç¤ºå™¨
      if (currentContent !== originalDecryptedContent && currentContent.length > 0) {
        document.getElementById('reEncryptBtn').style.display = 'inline-block';
        document.getElementById('modifiedIndicator').style.display = 'inline';
      } else {
        document.getElementById('reEncryptBtn').style.display = 'none';
        document.getElementById('modifiedIndicator').style.display = 'none';
      }
    }

    // é‡æ–°åŠ å¯†ä¿®æ”¹åçš„å†…å®¹å¹¶å¯¼å‡º
    async function reEncryptAndExport() {
      var modifiedText = document.getElementById('decryptedOutput').value;
      var password = document.getElementById('decPassword').value;

      if (!modifiedText) {
        alert('æ²¡æœ‰å†…å®¹å¯ä»¥åŠ å¯†');
        return;
      }

      if (!password) {
        alert('è¯·å…ˆè¾“å…¥ä¸»å¯†ç è¿›è¡Œè§£å¯†ï¼Œä»¥ä¾¿ä½¿ç”¨ç›¸åŒå¯†ç é‡æ–°åŠ å¯†');
        return;
      }

      try {
        // ä½¿ç”¨å½“å‰å¯†ç é‡æ–°åŠ å¯†ä¿®æ”¹åçš„å†…å®¹
        var encData = await encryptData(modifiedText, password);
        var jsonString = JSON.stringify(encData);

        // åˆ›å»ºBlobå¯¹è±¡
        var blob = new Blob([jsonString], { type: 'application/json' });

        // åˆ›å»ºä¸‹è½½é“¾æ¥
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 're-encrypted_' + new Date().getTime() + '.json';

        // è§¦å‘ä¸‹è½½
        document.body.appendChild(a);
        a.click();

        // æ¸…ç†
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert('âœ“ ä¿®æ”¹åçš„å†…å®¹å·²é‡æ–°åŠ å¯†å¹¶å¯¼å‡º\nğŸ”’ å¯†ç å·²è‡ªåŠ¨æ¸…é™¤ï¼Œç¡®ä¿å®‰å…¨');

        // æ›´æ–°åŸå§‹å†…å®¹ä¸ºå½“å‰å†…å®¹ï¼Œéšè—é‡æ–°åŠ å¯†æŒ‰é’®å’Œä¿®æ”¹æŒ‡ç¤ºå™¨
        originalDecryptedContent = modifiedText;
        document.getElementById('reEncryptBtn').style.display = 'none';
        document.getElementById('modifiedIndicator').style.display = 'none';

        // å®‰å…¨æªæ–½ï¼šé‡æ–°åŠ å¯†åæ¸…é™¤å¯†ç 
        securelyCleanPassword('decPassword');
      } catch (err) {
        alert('åŠ å¯†å¤±è´¥ï¼š' + err);
        console.error(err);
      }
    }

    // å®‰å…¨åœ°æ¸…é™¤å¯†ç è¾“å…¥æ¡†
    function securelyCleanPassword(inputId) {
      var input = document.getElementById(inputId);
      if (input && input.value) {
        // å¤šæ¬¡è¦†ç›–å¯†ç å†…å®¹ä»¥ç¡®ä¿å†…å­˜ä¸­çš„æ•°æ®è¢«æ¸…é™¤
        var length = input.value.length;
        input.value = '0'.repeat(length);
        input.value = '1'.repeat(length);
        input.value = '';
        console.log('ğŸ”’ å¯†ç å·²å®‰å…¨æ¸…é™¤');
      }
    }

    // é¡µé¢å¸è½½æ—¶æ¸…ç†æ•æ„Ÿæ•°æ®
    window.addEventListener('beforeunload', function() {
      securelyCleanPassword('decPassword');
      securelyCleanPassword('encPassword');
      document.getElementById('decryptedOutput').value = '';
      originalDecryptedContent = '';
    });

    // æŠ˜å /å±•å¼€ä¿¡æ¯å—
    function toggleInfo(infoId) {
      var content = document.getElementById(infoId);
      var toggle = document.getElementById(infoId + 'Toggle');

      if (content.classList.contains('show')) {
        content.classList.remove('show');
        toggle.textContent = 'â–¼ å±•å¼€';
      } else {
        content.classList.add('show');
        toggle.textContent = 'â–² æ”¶èµ·';
      }
    }

    // å¯†ç è¾“å…¥æ¡†å›è½¦äº‹ä»¶å¤„ç†
    function handlePasswordKeyPress(event, action) {
      // æ£€æµ‹æ˜¯å¦æŒ‰ä¸‹å›è½¦é”®
      if (event.key === 'Enter' || event.keyCode === 13) {
        event.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º

        if (action === 'encrypt') {
          encrypt(); // è§¦å‘åŠ å¯†
        } else if (action === 'decrypt') {
          decrypt(); // è§¦å‘è§£å¯†
        }
      }
    }

    // Tabåˆ‡æ¢åŠŸèƒ½
    function switchTab(tabName) {
      // ç§»é™¤æ‰€æœ‰tabæŒ‰é’®çš„activeç±»
      var tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(function(btn) {
        btn.classList.remove('active');
      });

      // éšè—æ‰€æœ‰tabå†…å®¹
      var tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(function(content) {
        content.classList.remove('active');
      });

      // æ¿€æ´»é€‰ä¸­çš„tab
      if (tabName === 'encrypt') {
        document.querySelector('.tab-button:nth-child(1)').classList.add('active');
        document.getElementById('encryptTab').classList.add('active');
      } else if (tabName === 'decrypt') {
        document.querySelector('.tab-button:nth-child(2)').classList.add('active');
        document.getElementById('decryptTab').classList.add('active');
      }
    }

    // ===== æœç´¢åŠŸèƒ½ =====

    // å­˜å‚¨åŸå§‹è§£æåçš„æ•°æ®
    var parsedData = [];

    // å­˜å‚¨æ¨¡æ€æ¡†ä¸­çš„ä¸´æ—¶æ•°æ®å‰¯æœ¬ï¼ˆç”¨äºåˆ é™¤æ“ä½œï¼‰
    var tempSearchData = [];

    // æ ‡è®°æ˜¯å¦æœ‰æ•°æ®ä¿®æ”¹
    var searchDataModified = false;

    // æ¨¡ç³ŠåŒ¹é…ç®—æ³•ï¼ˆæ”¯æŒè¿ç»­å’Œéè¿ç»­ä¸¤ç§æ¨¡å¼ï¼‰
    function fuzzyMatch(text, query, continuous) {
      if (!query || !text) return false;

      // è½¬æ¢ä¸ºå°å†™è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…
      text = String(text).toLowerCase();
      query = String(query).toLowerCase();

      if (continuous) {
        // è¿ç»­åŒ¹é…æ¨¡å¼ï¼šä½¿ç”¨ indexOf æŸ¥æ‰¾è¿ç»­å­ä¸²
        return text.indexOf(query) !== -1;
      } else {
        // éè¿ç»­åŒ¹é…æ¨¡å¼ï¼šæŒ‰é¡ºåºæŸ¥æ‰¾æ¯ä¸ªå­—ç¬¦
        var queryIndex = 0;
        var textIndex = 0;

        // éå†æ–‡æœ¬ï¼ŒæŒ‰é¡ºåºæŸ¥æ‰¾æŸ¥è¯¢å­—ç¬¦
        while (textIndex < text.length && queryIndex < query.length) {
          if (text[textIndex] === query[queryIndex]) {
            queryIndex++;
          }
          textIndex++;
        }

        // å¦‚æœæ‰€æœ‰æŸ¥è¯¢å­—ç¬¦éƒ½æ‰¾åˆ°äº†ï¼Œåˆ™åŒ¹é…æˆåŠŸ
        return queryIndex === query.length;
      }
    }

    // é«˜äº®åŒ¹é…çš„æ–‡æœ¬
    function highlightMatch(text, query, continuous) {
      if (!query || !text) return escapeHtml(String(text));

      var originalText = String(text);
      var lowerText = originalText.toLowerCase();
      var lowerQuery = String(query).toLowerCase();

      if (continuous) {
        // è¿ç»­åŒ¹é…ï¼šé«˜äº®æ•´ä¸ªè¿ç»­å­ä¸²
        var startIndex = lowerText.indexOf(lowerQuery);
        if (startIndex === -1) return escapeHtml(originalText);

        var result = '';
        result += escapeHtml(originalText.substring(0, startIndex));
        result += '<span class="highlight">' + escapeHtml(originalText.substring(startIndex, startIndex + query.length)) + '</span>';
        result += escapeHtml(originalText.substring(startIndex + query.length));

        return result;
      } else {
        // éè¿ç»­åŒ¹é…ï¼šæŒ‰é¡ºåºé«˜äº®æ¯ä¸ªå­—ç¬¦
        var result = '';
        var queryIndex = 0;

        for (var i = 0; i < originalText.length; i++) {
          if (queryIndex < lowerQuery.length && lowerText[i] === lowerQuery[queryIndex]) {
            // åŒ¹é…çš„å­—ç¬¦ç”¨ highlight æ ·å¼åŒ…è£¹
            result += '<span class="highlight">' + escapeHtml(originalText[i]) + '</span>';
            queryIndex++;
          } else {
            result += escapeHtml(originalText[i]);
          }
        }

        return result;
      }
    }

    // HTML è½¬ä¹‰
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æ‰“å¼€æœç´¢æ¨¡æ€æ¡†
    function openSearchModal() {
      var decryptedText = document.getElementById('decryptedOutput').value;

      if (!decryptedText || decryptedText === '(è§£å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘)') {
        alert('æ²¡æœ‰å¯æœç´¢çš„è§£å¯†æ•°æ®');
        return;
      }

      // å°è¯•è§£æ JSON æ•°æ®
      try {
        parsedData = JSON.parse(decryptedText);

        // ç¡®ä¿æ˜¯æ•°ç»„
        if (!Array.isArray(parsedData)) {
          // å¦‚æœæ˜¯å•ä¸ªå¯¹è±¡ï¼Œè½¬æ¢ä¸ºæ•°ç»„
          parsedData = [parsedData];
        }

        // åˆ›å»ºä¸´æ—¶æ•°æ®å‰¯æœ¬ï¼ˆæ·±æ‹·è´ï¼‰
        tempSearchData = JSON.parse(JSON.stringify(parsedData));
        searchDataModified = false;

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        document.getElementById('searchModal').classList.add('show');

        // é‡ç½®æœç´¢
        document.getElementById('searchInput').value = '';
        document.getElementById('searchKeySelect').value = 'default';
        document.getElementById('continuousMode').checked = true;

        // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
        performSearch();

        // èšç„¦åˆ°æœç´¢æ¡†
        setTimeout(function() {
          document.getElementById('searchInput').focus();
        }, 100);

      } catch (e) {
        alert('è§£å¯†æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è§£æä¸º JSON æ ¼å¼ã€‚\n\né¢„æœŸæ ¼å¼ï¼šå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å« uuid, title, username, password, info, created, modified å­—æ®µã€‚');
        console.error('JSON è§£æå¤±è´¥:', e);
      }
    }

    // å…³é—­æœç´¢æ¨¡æ€æ¡†
    function closeSearchModal() {
      // å¦‚æœæœ‰æ•°æ®ä¿®æ”¹ï¼ŒåŒæ­¥åˆ°åŸè§£å¯†æ•°æ®
      if (searchDataModified) {
        // è¿‡æ»¤æ‰æ ‡è®°ä¸ºåˆ é™¤çš„æ•°æ®
        var filteredData = tempSearchData.filter(function(item) {
          return !item._deleted;
        });

        // ç§»é™¤ä¸´æ—¶æ ‡è®°å­—æ®µ
        filteredData = filteredData.map(function(item) {
          var cleanItem = {};
          for (var key in item) {
            if (key !== '_deleted') {
              cleanItem[key] = item[key];
            }
          }
          return cleanItem;
        });

        // æ›´æ–°åˆ°åŸè§£å¯†è¾“å‡ºæ¡†
        document.getElementById('decryptedOutput').value = JSON.stringify(filteredData, null, 2);

        // è§¦å‘å†…å®¹ä¿®æ”¹æ£€æµ‹
        handleDecryptedContentChange();

        console.log('âœ“ æœç´¢æ•°æ®å·²åŒæ­¥åˆ°è§£å¯†è¾“å‡º');
      }

      // å…³é—­æ¨¡æ€æ¡†
      document.getElementById('searchModal').classList.remove('show');
      parsedData = [];
      tempSearchData = [];
      searchDataModified = false;
    }

    // ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
    function closeSearchModalOnBackdrop(event) {
      if (event.target.id === 'searchModal') {
        closeSearchModal();
      }
    }

    // æ‰§è¡Œæœç´¢
    function performSearch() {
      var query = document.getElementById('searchInput').value;
      var searchKey = document.getElementById('searchKeySelect').value;
      var continuous = document.getElementById('continuousMode').checked;

      var results = [];

      // ä½¿ç”¨ä¸´æ—¶æ•°æ®å‰¯æœ¬è¿›è¡Œæœç´¢ï¼ˆåŒ…å«åˆ é™¤æ ‡è®°çš„æ•°æ®ï¼‰
      var searchSource = tempSearchData.length > 0 ? tempSearchData : parsedData;

      if (!query) {
        // å¦‚æœæ²¡æœ‰æŸ¥è¯¢ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ•°æ®
        results = searchSource;
      } else {
        // æ ¹æ®é€‰æ‹©çš„å­—æ®µè¿›è¡Œæœç´¢
        if (searchKey === 'default') {
          // é»˜è®¤æœç´¢ title, username, info
          results = searchSource.filter(function(item) {
            return fuzzyMatch(item.title, query, continuous) ||
                   fuzzyMatch(item.username, query, continuous) ||
                   fuzzyMatch(item.info, query, continuous);
          });
        } else {
          // æœç´¢æŒ‡å®šå­—æ®µ
          results = searchSource.filter(function(item) {
            return fuzzyMatch(item[searchKey], query, continuous);
          });
        }
      }

      // æ˜¾ç¤ºæœç´¢ç»“æœ
      renderSearchResults(results, query, searchKey, continuous);
    }

    // æ¸²æŸ“æœç´¢ç»“æœ
    function renderSearchResults(results, query, searchKey, continuous) {
      var resultsContainer = document.getElementById('searchResults');
      var statsDiv = document.getElementById('searchStats');
      var countSpan = document.getElementById('searchCount');

      // æ›´æ–°ç»Ÿè®¡
      countSpan.textContent = results.length;
      statsDiv.style.display = results.length > 0 ? 'block' : 'none';

      // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
      resultsContainer.innerHTML = '';

      if (results.length === 0) {
        // æ˜¾ç¤ºç©ºçŠ¶æ€
        resultsContainer.innerHTML = '<div class="search-empty">' +
          '<div class="search-empty-icon">ğŸ”</div>' +
          '<div>æœªæ‰¾åˆ°åŒ¹é…çš„ç»“æœ</div>' +
          '</div>';
        return;
      }

      // æ¸²æŸ“æ¯ä¸ªç»“æœ
      results.forEach(function(item, index) {
        // æ‰¾åˆ°è¯¥é¡¹åœ¨ tempSearchData ä¸­çš„å®é™…ç´¢å¼•
        var realIndex = tempSearchData.indexOf(item);

        var itemDiv = document.createElement('div');
        itemDiv.className = 'search-result-item';
        itemDiv.setAttribute('data-index', realIndex);

        // å¦‚æœå·²æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ·»åŠ åˆ é™¤æ ·å¼
        if (item._deleted) {
          itemDiv.classList.add('deleted');
        }

        var html = '<div class="search-result-header">' +
          '<div class="search-result-title">' + highlightText(item.title, query, searchKey, 'title', continuous) + '</div>' +
          '<div class="search-result-actions">';

        // æ·»åŠ å¤åˆ¶ UUID æŒ‰é’®
        if (item.uuid && !item._deleted) {
          html += '<button class="search-action-btn copy-btn" onclick="copyUUID(\'' + escapeHtml(item.uuid) + '\')" title="å¤åˆ¶ UUID">ğŸ“‹ å¤åˆ¶ UUID</button>';
        }

        // æ·»åŠ åˆ é™¤/æ’¤é”€åˆ é™¤æŒ‰é’®
        if (item._deleted) {
          html += '<button class="search-action-btn" onclick="undoDeleteItem(' + realIndex + ')" title="æ’¤é”€åˆ é™¤">â†©ï¸ æ’¤é”€</button>';
        } else {
          html += '<button class="search-action-btn delete-btn" onclick="deleteSearchItem(' + realIndex + ')" title="åˆ é™¤æ­¤é¡¹">ğŸ—‘ï¸ åˆ é™¤</button>';
        }

        html += '</div></div>';

        // æ˜¾ç¤ºå„ä¸ªå­—æ®µ
        if (item.uuid) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">UUID:</span>' +
            '<span class="search-result-value">' + highlightText(item.uuid, query, searchKey, 'uuid', continuous) + '</span>' +
            '</div>';
        }

        if (item.username) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">Username:</span>' +
            '<span class="search-result-value">' + highlightText(item.username, query, searchKey, 'username', continuous) + '</span>' +
            '</div>';
        }

        if (item.password) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">Password:</span>' +
            '<span class="search-result-value search-result-password" onclick="togglePasswordVisibility(this)" data-password="' + escapeHtml(item.password) + '">********</span>' +
            '</div>';
        }

        if (item.info) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">Info:</span>' +
            '<span class="search-result-value">' + highlightText(item.info, query, searchKey, 'info', continuous) + '</span>' +
            '</div>';
        }

        if (item.created) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">Created:</span>' +
            '<span class="search-result-value">' + highlightText(item.created, query, searchKey, 'created', continuous) + '</span>' +
            '</div>';
        }

        if (item.modified) {
          html += '<div class="search-result-field">' +
            '<span class="search-result-label">Modified:</span>' +
            '<span class="search-result-value">' + highlightText(item.modified, query, searchKey, 'modified', continuous) + '</span>' +
            '</div>';
        }

        itemDiv.innerHTML = html;
        resultsContainer.appendChild(itemDiv);
      });
    }

    // é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ–‡æœ¬ï¼ˆæ ¹æ®æœç´¢å­—æ®µå†³å®šæ˜¯å¦é«˜äº®ï¼‰
    function highlightText(text, query, searchKey, currentField, continuous) {
      if (!query) return escapeHtml(String(text || ''));

      // å¦‚æœæ˜¯é»˜è®¤æœç´¢ä¸”å½“å‰å­—æ®µæ˜¯ title, username, info ä¹‹ä¸€ï¼Œæˆ–è€…æœç´¢æŒ‡å®šå­—æ®µ
      if ((searchKey === 'default' && (currentField === 'title' || currentField === 'username' || currentField === 'info')) ||
          searchKey === currentField) {
        return highlightMatch(text, query, continuous);
      }

      return escapeHtml(String(text || ''));
    }

    // åˆ‡æ¢å¯†ç æ˜¾ç¤º/éšè—
    function togglePasswordVisibility(element) {
      var password = element.getAttribute('data-password');
      if (element.textContent === '********') {
        element.textContent = password;
        element.style.fontFamily = 'monospace';
      } else {
        element.textContent = '********';
      }
    }

    // å¤åˆ¶ UUID åˆ°å‰ªè´´æ¿
    function copyUUID(uuid) {
      navigator.clipboard.writeText(uuid).then(function() {
        // æ˜¾ç¤ºä¸´æ—¶æç¤º
        alert('âœ“ UUID å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\n\n' + uuid);
      }).catch(function(err) {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + uuid);
        console.error('å¤åˆ¶å¤±è´¥:', err);
      });
    }

    // åˆ é™¤æœç´¢ç»“æœé¡¹
    function deleteSearchItem(index) {
      if (index < 0 || index >= tempSearchData.length) {
        console.error('æ— æ•ˆçš„ç´¢å¼•:', index);
        return;
      }

      var item = tempSearchData[index];

      // ç¡®è®¤åˆ é™¤
      var confirmed = confirm('ç¡®å®šè¦åˆ é™¤æ­¤é¡¹å—ï¼Ÿ\n\næ ‡é¢˜ï¼š' + item.title + '\nç”¨æˆ·åï¼š' + (item.username || 'æ— ') + '\n\nåˆ é™¤åå¯ä»¥é€šè¿‡"æ’¤é”€"æŒ‰é’®æ¢å¤ã€‚');

      if (confirmed) {
        // æ ‡è®°ä¸ºåˆ é™¤
        tempSearchData[index]._deleted = true;
        searchDataModified = true;

        // é‡æ–°æ¸²æŸ“æœç´¢ç»“æœ
        performSearch();

        console.log('âœ“ é¡¹ç›®å·²æ ‡è®°ä¸ºåˆ é™¤:', item.title);
      }
    }

    // æ’¤é”€åˆ é™¤
    function undoDeleteItem(index) {
      if (index < 0 || index >= tempSearchData.length) {
        console.error('æ— æ•ˆçš„ç´¢å¼•:', index);
        return;
      }

      // ç§»é™¤åˆ é™¤æ ‡è®°
      delete tempSearchData[index]._deleted;

      // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–ä¿®æ”¹
      searchDataModified = tempSearchData.some(function(item) {
        return item._deleted;
      });

      // é‡æ–°æ¸²æŸ“æœç´¢ç»“æœ
      performSearch();

      console.log('âœ“ åˆ é™¤å·²æ’¤é”€');
    }

    // å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬
    document.addEventListener('keydown', function(event) {
      // ESC é”®å…³é—­æœç´¢æ¨¡æ€æ¡†æˆ–å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†
      if (event.key === 'Escape') {
        if (document.getElementById('searchModal').classList.contains('show')) {
          closeSearchModal();
          return;
        }
        if (document.getElementById('quickAddModal').classList.contains('show')) {
          closeQuickAddModal();
          return;
        }
      }

      // å›è½¦é”®å¿«æ·æ“ä½œï¼ˆä»…åœ¨è§£å¯† tab ä¸”æ²¡æœ‰è¾“å…¥æ¡†èšç„¦æ—¶ï¼‰
      if (event.key === 'Enter') {
        // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¯è§£å¯† tab
        var decryptTab = document.getElementById('decryptTab');
        if (!decryptTab.classList.contains('active')) {
          return; // ä¸æ˜¯è§£å¯† tabï¼Œä¸å¤„ç†
        }

        // æ£€æŸ¥æœç´¢æ¨¡æ€æ¡†æ˜¯å¦æ‰“å¼€
        if (document.getElementById('searchModal').classList.contains('show')) {
          return; // æœç´¢æ¨¡æ€æ¡†æ‰“å¼€æ—¶ä¸å¤„ç†
        }

        // æ£€æŸ¥å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†æ˜¯å¦æ‰“å¼€
        if (document.getElementById('quickAddModal').classList.contains('show')) {
          return; // å¿«é€Ÿæ·»åŠ æ¨¡æ€æ¡†æ‰“å¼€æ—¶ä¸å¤„ç†
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰è¾“å…¥æ¡†èšç„¦
        var activeElement = document.activeElement;
        var isInputFocused = activeElement && (
          activeElement.tagName === 'INPUT' ||
          activeElement.tagName === 'TEXTAREA' ||
          activeElement.tagName === 'SELECT' ||
          activeElement.isContentEditable
        );

        if (isInputFocused) {
          return; // æœ‰è¾“å…¥æ¡†èšç„¦æ—¶ä¸å¤„ç†
        }

        // æ£€æŸ¥è§£å¯†è¾“å‡ºæ¡†çš„çŠ¶æ€
        var decryptedOutput = document.getElementById('decryptedOutput').value;
        var hasDecryptedContent = decryptedOutput && decryptedOutput !== '(è§£å¯†åçš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘)';

        if (hasDecryptedContent) {
          // æœ‰è§£å¯†å†…å®¹ â†’ æ‰“å¼€æœç´¢æ¨¡æ€æ¡†
          var searchBtn = document.getElementById('searchBtn');
          if (searchBtn && searchBtn.style.display !== 'none') {
            openSearchModal();
          }
        } else {
          // æ²¡æœ‰è§£å¯†å†…å®¹ â†’ æ‰“å¼€å¯¼å…¥æ–‡ä»¶å¯¹è¯æ¡†
          document.getElementById('importEncFile').click();
        }
      }
    });

</script>
</body>
</html>
